<html>

<head>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" href="css/formio.full.min.css">
    <script src="js/formio.full.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <style>
        .checked {
            color: orange;
        }

        /* .fa-star:hover{
            color: red;
        } */


    </style>
</head>

<body>
    <div class="container">
        <h3>Create Custom Component </h3>
        <div id="builder"></div>
        <div id="formio"></div>
        <!-- <div id="json"></div>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star checked"></span>
        <span class="fa fa-star"></span> -->
    </div>
    <script type="text/javascript">

        $(".fa-star").hover(function () {

            // console.log("Hover");

        });

        var BaseComponent = Formio.Components.components.base;

        // console.log(":: ",BaseComponent);

        /*
            STEP: 1
        */

        function aCom(component, options, data) {

            console.log("acom data", data);
            BaseComponent.prototype.constructor.call(this, component, options, data);

        }

        // a = [];

        aCom.prototype = Object.create(BaseComponent.prototype);
        aCom.prototype.constructor = aCom;





        /*
            STEP: 2
            Define Default JSON Component.
        */


        aCom.schema = function () {
            return BaseComponent.schema({
                type: 'rating',
                numRows: 10,
                numCols: 0
            });
        };


        // console.log("componentA :: schema", aCom.schema());
        // console.log("Base component", BaseComponent.schema());




        /*
            STEP: 3
            exampleObject.builderInfo
        */

        aCom.builderInfo = {
            title: 'Example',
            group: 'basic',
            icon: 'fa fa-star-o',
            weight: 70,
            documentation: 'http://help.form.io/userguide/#table',
            schema: aCom.schema()
        }


        // console.log("a builderInfo ", aCom.builderInfo);


        /*
            STEP: 4
            Tell the renderer how to build this component using DOM manipulation. 
            exampleObject.prototype.build = function(){}
            
        */

        aCom.prototype.build = function () {


            //------------------------------
            this.element = this.ce('div',{
                    class:"test-rating"
                });

                console.log("### ",this);

                for(i=0;i<1;i++){

                    ilist = this.ce('div',{
                        
                    });

                    ilist.textContent = "Example";
                    this.addInput(ilist);
                    this.element.appendChild(ilist);
                }

            //------------------------------
            // this.element = this.ce('div', {
            //     class: 'table-responsive'
            // });
            // this.createLabel(this.element);

            // var tableClass = 'table ';
            // ['striped', 'bordered', 'hover', 'condensed'].forEach(function (prop) {
            //     if (this.component[prop]) {
            //         tableClass += `table-${prop} `;
            //     }
            // }.bind(this));

            // var table = this.ce('table', {
            //     class: tableClass
            // });

            // // Build the body.
            // var tbody = this.ce('tbody');
            // // this.inputs = [];
            //  this.checks = [];
            // for (let i = 0; i < this.component.numRows; i++) {
            //     var tr = this.ce('tr');
            //     this.checks.push([]);
            //     for (let j = 0; j < this.component.numCols; j++) {
            //         var td = this.ce('td');
            //         this.checks[i][j] = this.ce('input', {
            //             type: 'radio'
            //         });
            //         this.addInput(this.checks[i][j], td);
            //         tr.appendChild(td);
            //     }
            //     tbody.appendChild(tr);
            // }
            // table.appendChild(tbody);
            // this.element.appendChild(table);


            // this.element = this.ce('div', {

            // });


            // iList = this.ce('div', {
            //     class: 'rating'
            // });


            // for (let i = 0; i < this.component.numRows; i++) {
            //     starElement = this.ce('input', {
            //         class: '',
            //         type: "checkbox",

            //     });

            //     imga = this.ce('i',{
            //         class: 'fa fa-star'
            //     });

            //     iList.appendChild(starElement);
            //     // iList.appendChild(imga);


            // }


            // this.element.appendChild(iList);



            // this.inputs = [];
            // // console.log('thisElement ', this);
            // this.createLabel(this.element);

            // // console.log("This Component: ", this.component.numRows);
            // for (let i = 0; i < this.component.numRows; i++) {
            //     starElement = this.ce('span', {
            //         class: 'fa fa-star',
            //     });

            //     iList.appendChild(starElement);
            //     // console.log("round ", i);
            // }

            // // this.element.textContent = 'Hello XD';



            // // var tableClass = 'table ';
            // // ['striped', 'bordered', 'hover', 'condensed'].forEach(function (prop) {
            // //     if (this.component[prop]) {
            // //         tableClass += `table-${prop} `;
            // //     }
            // // }.bind(this));

            // // var table = this.ce('table', {
            // //     class: tableClass
            // // });


            // // // Build the body.
            // // var tbody = this.ce('tbody');
            // // this.inputs = [];
            // // this.checks = [];
            // // for (let i = 0; i < this.component.numRows; i++) {
            // //     var tr = this.ce('tr');
            // //     this.checks.push([]);
            // //     for (let j = 0; j < this.component.numCols; j++) {
            // //         var td = this.ce('td');
            // //         this.checks[i][j] = this.ce('input', {
            // //             type: 'checkbox'
            // //         });
            // //         this.addInput(this.checks[i][j], td);
            // //         tr.appendChild(td);
            // //     }
            // //     tbody.appendChild(tr);
            // // }
            // // table.appendChild(tbody);


            // var h = document.createElement("H3")
            // var t = document.createTextNode("Rating Component");
            // h.appendChild(t);

            // this.element.appendChild(h);
            // this.element.appendChild(h);

            // this.element.appendChild(h);

            // this.element.appendChild(iList);
            // this.element = this.ce('div', {
            //     class: 'table-responsive'
            // });
            // this.createLabel(this.element);

            // var tableClass = 'table ';
            // ['striped', 'bordered', 'hover', 'condensed'].forEach(function (prop) {
            //     if (this.component[prop]) {
            //         tableClass += `table-${prop} `;
            //     }
            // }.bind(this));

            // var table = this.ce('table', {
            //     class: tableClass
            // });

            // // Build the body.
            // var tbody = this.ce('tbody');
            // this.inputs = [];
            // this.checks = [];
            // for (let i = 0; i < this.component.numRows; i++) {
            //     var tr = this.ce('tr');
            //     this.checks.push([]);
            //     for (let j = 0; j < this.component.numCols; j++) {
            //         var td = this.ce('td');
            //         this.checks[i][j] = this.ce('input', {
            //             type: 'radio'
            //         });
            //         this.addInput(this.checks[i][j], td);
            //         tr.appendChild(td);
            //     }
            //     tbody.appendChild(tr);
            // }
            // table.appendChild(tbody);
            // this.element.appendChild(table);


        }


        /*
            STEP: 5
            Provide the input element information.
            default is "change".

            what are another event name.
        */

        // aCom.prototype.elementInfo = function () {


        //     const info = BaseComponent.prototype.elementInfo.call(this);
        //     info.changeEvent = 'click';
        //     console.log("elementInfo");
        //     return info;

        // };

        aCom.prototype.elementInfo = function () {
            console.log(":elementInfo:", this);
            const info = BaseComponent.prototype.elementInfo.call(this);
            console.log("THIS ELEMNT-info: info.changeEvent", info.changeEvent);
            info.changeEvent = 'click';
            // console.log("element-Info");
            // console.log("THIS ELEMNT-info: info.changeEvent",info.changeEvent);

            return info;
        };


        /*
            Test 
        */
        // value = 10;
        

        aCom.prototype.getValue = function () {
            console.log("getValue")
            var value;
            // value = "A"; 
                value = Math.floor(Math.random() * 2) + 1  
              
            // for (var rowIndex in this.checks) {
            //     var row = this.checks[rowIndex];
            //     value[rowIndex] = [];
            //     for (var colIndex in row) {
            //         var col = row[colIndex];
            //         value[rowIndex][colIndex] = "a";
            //     }
            // }
 
            console.log(this);    
            if(value == 1){


                value = 'B'
                return value ;

            }else if(value == 2){

                value = 'A'
                return value;
            }

            

            // console.log("GetValue",value);
            return value;
            // var value = [];

            // if(clickedElement.noUpdateEvent != true){
            //     //  console.log("clickedElement: ",clickedElement);
            //      console.log($(clickedElement.target.offsetParent).find('.rating'));
            //      itemElement = $(clickedElement.target.offsetParent).find('.rating');
            //     //  console.log("itemElement: ",itemElement);
            //      console.log("GetVal: ",$(itemElement[0]).find('.selected-star'));
            //     // console.log("value: ",value);


            //     // Set Value 
            //     // value['x'] = 10;
            //     // value['y'] = 20;

            //     value = "Test";



            //     return value;


            // }




            // // var value = 0;

            // console.log("get Value ",value);
            // return value;

            // console.log('getValue : this', this);
            // console.log('getValue : this.element', this.element);
            // test = $(this.element).html();
            // console.log("HEY! ",$(test + ".rating"));

            // console.log($(this.element).find('.rating'));

            /*
                        itemElement = $(this.element).find('.rating');
                        console.log("itemElement: ",itemElement);
                        console.log("GetVal: ",$(itemElement).find('.selected-star'));
                        console.log("value: ",value);
            */



            // return value = 10;
        }
        aCom.prototype.setValue = function (value) {

            // console.log("setValue: ", this);
            // console.log("setValue[value]: ", value);
            value = 20;

            // if (!value) {
            //     return;
            // }
            // for (var rowIndex in this.checks) {
            //     var row = this.checks[rowIndex];
            //     if (!value[rowIndex]) {
            //         break;
            //     }
            //     for (var colIndex in row) {
            //         var col = row[colIndex];
            //         if (!value[rowIndex][colIndex]) {
            //             return false;
            //         }
            //         let checked = value[rowIndex][colIndex] ? 1 : 0;
            //         col.value = checked;
            //         col.checked = checked;
            //     }
            // }





        };
        /**





        /*
             STEP: 6
             Component edit form
        */

        aCom.editForm = Formio.Components.components.form.editForm;


        /*
              STEP: 7
              Register the component 
         
        */

        Formio.Components.addComponent('rating', aCom);





        Formio.builder(document.getElementById('builder'), {}, {
            builder: {
                basic: false,
                advanced: false,
                data: false,
                layout: false,
                customBasic: {
                    title: 'Basic Components Test',
                    default: true,
                    weight: 0,
                    components: {
                        rating: true
                    }
                }
            }
        }).then(function (builder) {
            Formio.createForm(document.getElementById('formio'), {}).then(function (instance) {
                var json = document.getElementById('json');


                instance.on('change', function () {
                    json.innerHTML = '';
                    // json.appendChild(document.createTextNode(JSON.stringify(instance.submission, null, 4)));
                });

                instance.on('submit', function (evt) {

                    console.log("Submission=> ", evt);
                    // debugger
                    // console.log("SUBMIT: ", evt);

                });

                builder.on('change', function (schema) {
                    if (schema.components) {
                        instance.form = schema;
                    }


                    // // console.log("Test");
                    // $(".fa-star").mouseover(function () {
                    //     // console.log("Hover");
                    //     // console.log(this);
                    //     // $(this).css("color", "yellow");
                    //     // $(this).prevAll().css("color", "yellow");

                    // }).mouseleave(function () {
                    //     // $(this).css("color", "black");
                    //     // $(this).prevAll().css("color", "black");
                    // });


                    // $('.rating').click(function (evt) {

                    //     // console.log("Tis element ",evt);
                    //     // console.log(this);
                    //     // $(this).css("color", "red");

                    //     console.log("Event", evt);
                    //     $(evt.toElement).css("color", 'green');
                    //     $(evt.toElement).prevAll().css("color", "green");
                    //     $(evt.toElement).nextAll().css("color", "black");
                    // })

                });



                instance.on('change', function (schema) {
                    if (schema.components) {
                        instance.form = schema;
                    }

                    // console.log("Submission ",instance.submission);


                    // console.log("Test");
                    $(".fa-star").mouseover(function () {
                        // console.log("Hover");
                        // console.log(this);
                        // $(this).css("color", "yellow");
                        // $(this).prevAll().css("color", "yellow");

                    }).mouseleave(function () {
                        // $(this).css("color", "black");
                        // $(this).prevAll().css("color", "black");
                    });


                    $('.rating').click(function (evt) {

                        //  console.log("Tis element ",evt);
                        // console.log(this);
                        // $(this).css("color", "red");
                        // console.log("Event", evt);



                        $(evt.toElement).css("color", 'green');
                        $(evt.toElement).prevAll().css("color", "green");
                        $(evt.toElement).nextAll().css("color", "black");
                        //----- 

                        $(evt.toElement).addClass("selected-star");
                        $(evt.toElement).prevAll().addClass("selected-star");
                        $(evt.toElement).nextAll().removeClass("selected-star");

                        aCom.prototype.getValue(evt);

                    })

                });




            });


        });



    </script>
</body>

</html>